/*!
 * Cool Menu
 * @author      delphinpro <delphinpro@gmail.com>
 * @copyright   copyright © 2017—2018 delphinpro
 * @license     licensed under the MIT license
 * @version     1.0.0
 * 
 * https://github.com/delphinpro/cool-menu
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"CoolMenu",function(){return h});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function l(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a="CoolMenu: Invalid source, expected array of UL/OL elements";function s(e){return e instanceof HTMLOListElement||e instanceof HTMLUListElement}function i(e){var t=[];return[].forEach.call(e.children,function(e){var n=[].filter.call(e.children,function(e){return function(e){return e instanceof HTMLAnchorElement}(e)})[0],r=[].filter.call(e.children,function(e){return s(e)})[0],o={text:n.innerText.trim(),link:n.getAttribute("href")||"",children:!1};r&&(o.children=i(r)),t.push(o)}),t}function c(e,t){var n=document.createElement(e);return n.classList.add(t),n}function u(e,t,n,r){var o=null;"."===n.charAt(0)&&(o=n.replace(/^\./,"")),e.addEventListener(t,function(e){for(var t=e.target;t!==this;){if(t.tagName===n.toUpperCase()||o&&t.classList.contains(o)){r(e,t);break}t=t.parentNode}})}var h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);if(this.data=[],this.level=0,this.opt=r({source:null,button:null,container:document.body,width:320,delimiter:!1,headerText:"Menu",rootClass:"cool-menu",stateOpenClass:"cool-menu_open",scrollPaneClass:"cool-menu__scroll-pane",closerClass:"cool-menu__closer",headerClass:"cool-menu__header",headerInnerClass:"cool-menu__header-in",headerActiveClass:"cool-menu__header_active",menuClass:"cool-menu__menu",menuItemClass:"cool-menu__item",menuLinkClass:"cool-menu__link",menuNestedClass:"cool-menu__nested",backdropClass:"cool-menu-backdrop",buttonOpenClass:"open",bodyOpenClass:"is-open-cool-menu",onClose:null},t),this.headers=[this.opt.headerText],t.source&&!Array.isArray(t.source))throw new Error(a);this.loadData()}return o(e,[{key:"create",value:function(){this.html={container:this.opt.container,coolMenu:c("div",this.opt.rootClass),scrollPane:c("div",this.opt.scrollPaneClass),header:c("div",this.opt.headerClass),headerIn:c("div",this.opt.headerInnerClass),closer:c("div",this.opt.closerClass),backdrop:c("div",this.opt.backdropClass)},this.html.header.appendChild(this.html.closer),this.html.header.appendChild(this.html.headerIn),this.html.coolMenu.appendChild(this.html.header),this.html.coolMenu.appendChild(this.html.scrollPane),this.html.container.appendChild(this.html.backdrop),this.html.container.appendChild(this.html.coolMenu),this.updateHeaderText(),this.attachEvents(),this.render()}},{key:"updateHeaderText",value:function(){this.html.headerIn.innerHTML=this.headers[this.headers.length-1]}},{key:"addHeaderText",value:function(e){this.headers.push(e)}},{key:"removeHeaderText",value:function(){this.headers.pop()}},{key:"loadData",value:function(){var e=this;this.opt.source.forEach(function(t){if(!function(e){return s(e)}(t))throw new Error(a);e.data=[].concat(l(e.data),l(i(t)))})}},{key:"toggleMenu",value:function(e){this.opt.button&&this.opt.button.classList.toggle(this.opt.buttonOpenClass,e),this.html.coolMenu.classList.toggle(this.opt.stateOpenClass,e),document.body.classList.toggle(this.opt.bodyOpenClass,e),e||"function"!=typeof this.opt.onClose||this.opt.onClose()}},{key:"attachEvents",value:function(){var e=this;this.html.backdrop.addEventListener("click",function(){return e.toggleMenu(!1)}),this.html.closer.addEventListener("click",function(t){t.stopPropagation(),e.toggleMenu(!1)}),u(this.html.coolMenu,"click","a",function(t,n){var r=JSON.parse(n.dataset.children);if(r){t.preventDefault(),e.level++,e.renderLevel(r),e.addHeaderText(n.innerText),e.updateHeaderText(),e.html.header.classList.add(e.opt.headerActiveClass);var o=getComputedStyle(e.html.scrollPane).left.replace(/px/,"");e.html.scrollPane.style.left=+o-e.opt.width+"px"}}),u(this.html.coolMenu,"click","."+this.opt.headerActiveClass,function(t,n){if(t.preventDefault(),e.level--,e.level>=0){var r=getComputedStyle(e.html.scrollPane).left.replace(/px/,"");e.html.scrollPane.style.left=+r+e.opt.width+"px";var o=e.html.scrollPane.children;o[o.length-1].remove(),e.html.header.classList.toggle(e.opt.headerActiveClass,0!==e.level),e.removeHeaderText(),e.updateHeaderText()}else e.level=0}),this.opt.button&&this.opt.button.addEventListener("click",function(t){t.preventDefault();var n=e.opt.button.classList.contains(e.opt.buttonOpenClass);e.toggleMenu(!n)})}},{key:"renderLevel",value:function(e){var t=this,n=c("ul",this.opt.menuClass);e.forEach(function(e){var r=c("li",t.opt.menuItemClass),o=c("a",t.opt.menuLinkClass);if(o.setAttribute("href",e.link),o.innerHTML=e.text,o.dataset.children=JSON.stringify(e.children),r.appendChild(o),e.children){var l=c("span",t.opt.menuNestedClass);l.innerHTML="<span>"+e.children.length+"</span>",l.dataset.children=e.children,r.appendChild(l)}n.appendChild(r)}),this.html.scrollPane.appendChild(n)}},{key:"render",value:function(){this.renderLevel(this.data)}}]),e}();t.default=h}])});