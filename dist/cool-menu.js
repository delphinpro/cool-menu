/*!
 * Cool Menu
 * @author      delphinpro <delphinpro@gmail.com>
 * @copyright   copyright © 2017—2019 delphinpro
 * @license     licensed under the MIT license
 * @version     2.0.1
 * 
 * https://github.com/delphinpro/cool-menu
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"CoolMenu",function(){return p});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function l(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a="CoolMenu: Invalid source, expected array of UL/OL elements";function i(e){return e instanceof HTMLOListElement||e instanceof HTMLUListElement}function c(e){return"object"===(void 0===e?"undefined":s(e))&&null!==e&&!(e instanceof Element)}function u(e,t){var n=document.createElement(e);return n.classList.add(t),n}function h(e,t,n,o){var r=null;"."===n.charAt(0)&&(r=n.replace(/^\./,"")),e.addEventListener(t,function(e){for(var t=e.target;t!==this;){if(t.tagName===n.toUpperCase()||r&&t.classList.contains(r)){o(e,t);break}t=t.parentNode}})}var d={group:null,container:null,selectorTitle:"a",selectorList:"ul"},p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);if(this.data=[],this.level=0,this.opt=r({source:null,button:null,container:document.body,width:320,delimiter:!1,headerText:"Menu",rootClass:"cool-menu",stateOpenClass:"cool-menu_open",scrollPaneClass:"cool-menu__scroll-pane",closerClass:"cool-menu__closer",headerClass:"cool-menu__header",headerInnerClass:"cool-menu__header-in",headerActiveClass:"cool-menu__header_active",menuClass:"cool-menu__menu",menuItemClass:"cool-menu__item",menuLinkClass:"cool-menu__link",menuNestedClass:"cool-menu__nested",backdropClass:"cool-menu-backdrop",buttonOpenClass:"open",bodyOpenClass:"is-open-cool-menu",onShow:null,onClose:null},t),this.headers=[this.opt.headerText],this.sources=[],t.source&&!Array.isArray(t.source))throw new Error(a);this.prepareSources(),this.loadData()}return o(e,[{key:"create",value:function(){this.html={container:this.opt.container,coolMenu:u("div",this.opt.rootClass),scrollPane:u("div",this.opt.scrollPaneClass),header:u("div",this.opt.headerClass),headerIn:u("div",this.opt.headerInnerClass),closer:u("div",this.opt.closerClass),backdrop:u("div",this.opt.backdropClass)},this.html.header.appendChild(this.html.closer),this.html.header.appendChild(this.html.headerIn),this.html.coolMenu.appendChild(this.html.header),this.html.coolMenu.appendChild(this.html.scrollPane),this.html.container.appendChild(this.html.backdrop),this.html.container.appendChild(this.html.coolMenu),this.updateHeaderText(),this.attachEvents(),this.render()}},{key:"updateHeaderText",value:function(){this.html.headerIn.innerHTML=this.headers[this.headers.length-1]}},{key:"addHeaderText",value:function(e){this.headers.push(e)}},{key:"removeHeaderText",value:function(){this.headers.pop()}},{key:"prepareSources",value:function(){var e=this;this.opt.source.forEach(function(t){var n=r({},d,c(t)?t:{container:t});!function(e){return c(e)?!!e.hasOwnProperty("container")&&i(e.container):i(e)}(n)?console.error(a):e.sources.push(n)})}},{key:"loadData",value:function(){var e=this;this.sources.forEach(function(t){var n=function e(t){var n=[];return Array.prototype.forEach.call(t.container.children,function(o){var s=o.querySelector(t.selectorTitle),l=o.querySelector(t.selectorList);if(s){var a={text:s.innerText.trim(),link:s.getAttribute("href")||"",children:!1};if(l&&i(l)){var c=r({},t,{container:l});a.children=e(c)}n.push(a)}}),n}(t);e.data=[].concat(l(e.data),l(t.group?[{text:t.group.title,link:t.group.link,customItemClass:t.group.customItemClass,customLinkClass:t.group.customLinkClass,children:n}]:n))})}},{key:"toggleMenu",value:function(e){this.opt.button&&this.opt.button.classList.toggle(this.opt.buttonOpenClass,e),this.html.coolMenu.classList.toggle(this.opt.stateOpenClass,e),document.body.classList.toggle(this.opt.bodyOpenClass,e),e&&"function"==typeof this.opt.onShow&&this.opt.onShow(),e||"function"!=typeof this.opt.onClose||this.opt.onClose()}},{key:"attachEvents",value:function(){var e=this;this.html.backdrop.addEventListener("click",function(){return e.toggleMenu(!1)}),this.html.closer.addEventListener("click",function(t){t.stopPropagation(),e.toggleMenu(!1)}),h(this.html.coolMenu,"click","."+this.opt.menuNestedClass,function(t,n){var o=JSON.parse(n.dataset.children);if(o){t.preventDefault(),e.level++,e.renderLevel(o),e.addHeaderText(n.dataset.header),e.updateHeaderText(),e.html.header.classList.add(e.opt.headerActiveClass);var r=getComputedStyle(e.html.scrollPane).left.replace(/px/,"");e.html.scrollPane.style.left=+r-e.opt.width+"px"}}),h(this.html.coolMenu,"click","."+this.opt.headerActiveClass,function(t,n){if(t.preventDefault(),e.level--,e.level>=0){var o=getComputedStyle(e.html.scrollPane).left.replace(/px/,"");e.html.scrollPane.style.left=+o+e.opt.width+"px";var r=e.html.scrollPane.children;r[r.length-1].remove(),e.html.header.classList.toggle(e.opt.headerActiveClass,0!==e.level),e.removeHeaderText(),e.updateHeaderText()}else e.level=0}),this.opt.button&&this.opt.button.addEventListener("click",function(t){t.preventDefault();var n=e.opt.button.classList.contains(e.opt.buttonOpenClass);e.toggleMenu(!n)})}},{key:"renderLevel",value:function(e){var t=this,n=u("ul",this.opt.menuClass);e.forEach(function(e){var o=u("li",t.opt.menuItemClass);e.customItemClass&&o.classList.add(e.customItemClass);var r=u("a",t.opt.menuLinkClass);if(r.setAttribute("href",e.link),r.innerHTML=e.text,e.customLinkClass&&r.classList.add(e.customLinkClass),o.appendChild(r),e.children){var s=u("span",t.opt.menuNestedClass);s.innerHTML="<span>"+e.children.length+"</span>",s.dataset.children=JSON.stringify(e.children),s.dataset.header=r.innerText,o.appendChild(s)}n.appendChild(o)}),this.html.scrollPane.appendChild(n)}},{key:"render",value:function(){this.renderLevel(this.data)}}]),e}();t.default=p}])});